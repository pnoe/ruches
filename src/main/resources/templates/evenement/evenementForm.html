<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{include :: common_header(~{::script},~{::style},~{::link})}">
	<script th:replace="~{include :: jsdatetimepicker}"></script>
	<link th:replace="~{include :: cssdatetimepicker}" />
	<script th:replace="~{include :: localejsdatetimepicker}"></script>
	<script th:inline="javascript">
		const complet = /*[[${complet}]]*/ null;
		document.addEventListener('DOMContentLoaded', () => {
			const ruchesClass = document.querySelectorAll('.ruches');
			if (complet === 'true') {
				document.getElementById('showruches').checked = true;
				ruchesClass.forEach(item => {
					item.style.display = 'block';
				});
			}
			document.getElementById('showruches').addEventListener('click', event => {
				ruchesClass.forEach(item => {
					item.style.display = event.target.checked ? 'block' : 'none';
				});
			});
			const form = $('#evenementForm');
			const typ = $('#type');
			form.validate({
				errorClass: 'erreur-form',
				errorPlacement: function (error, element) {
					error.insertBefore(element.closest('div'));
				},
				rules: {
					date: {
						required: true
					},
					ruche: {
						required: function () {
							return ['RUCHEAJOUTRUCHER', 'AJOUTESSAIMRUCHE', 'HAUSSEPOSERUCHE', 'HAUSSERETRAITRUCHE',
								'COMMENTAIRERUCHE']
								.includes(typ.val());
						}
					},
					rucher: {
						required: function () {
							return ['RUCHEAJOUTRUCHER', 'COMMENTAIRERUCHER']
								.includes(typ.val());
						}
					},
					essaim: {
						required: function () {
							return ['AJOUTESSAIMRUCHE', 'ESSAIMTRAITEMENT', 'ESSAIMTRAITEMENTFIN', 'ESSAIMSUCRE',
								'COMMENTAIREESSAIM', 'ESSAIMDISPERSION', 'RUCHEPESEE', 'RUCHECADRE']
								.includes(typ.val());
						}
					},
					hausse: {
						required: function () {
							return ['HAUSSEPOSERUCHE', 'HAUSSERETRAITRUCHE', 'HAUSSEREMPLISSAGE', 'COMMENTAIREHAUSSE']
								.includes(typ.val());
						}
					}
				}
			});
			/*[- Pour trier les noms de types d'événements -]*/
			const selOpt = typ.val();
			typ.html($('#type option').sort(function (a, b) {
				return a.text === b.text ? 0 : a.text < b.text ? -1 : 1;
			})).val(selOpt);
			typ.change(function () {form.valid();});
		});
	</script>
</head>

<body>
	<nav th:replace="~{navbar::navbar}"></nav>
	<br />
	<br />
	<br />
	<div class="container-fluid">
		<div class="row">
			<div class="col">
				<h1 class="item" th:unless="${evenement.id}">
					<th:block th:text="#{ajouterUn} + ' '"></th:block>
					<a th:href="@{'/evenement/liste'}" th:text="#{evenement}"></a>
				</h1>
				<h1 class="item" th:if="${evenement.id}">
					<th:block th:text="#{modification}"></th:block>
					<a th:href="@{'/evenement/'+${evenement.id}}"
						th:text="#{evenement} + ' ' + ${#temporals.format(evenement.date, 'yyyy/MM/dd HH:mm')}"></a>
				</h1>
			</div>
			<div class="col">
				<span class="padicons"> <input type="checkbox" id="showruches" th:title="#{afficherrucheetc}"
						th:text="#{afficherPlus}" />

				</span>
			</div>
		</div>
	</div>
	<form action="#" th:action="@{/evenement/sauve}" th:object="${evenement}" method="post" id="evenementForm">
		<input type="hidden" th:field="*{id}" />
		<div th:replace="~{includeForm :: dateField}"></div>
		<div class="form-floating mb-3">
			<input placeholder="" class="form-control" type="number" step="0.001" th:field="*{valeur}"
				th:errorclass="fieldError" maxlength="64" /> <label class="form-label" for="valeur"
				th:text="#{valeur}"></label>
		</div>
		<div th:replace="~{includeForm :: commentaireField}"></div>
		<div class="form-floating mb-3 ruches" style="display: none">
			<select class="form-control" th:field="*{type}">
				<option th:each="typeEvenement : ${T(ooioo.ruches.evenement.TypeEvenement).values()}"
					th:value="${typeEvenement}" th:text="#{${typeEvenement}}"></option>
			</select> <label class="form-label" for="typeEvenement" th:text="#{typeEvenement}"></label>
		</div>
		<div class="form-floating mb-3 ruches" style="display: none">
			<select class="form-control" th:field="*{ruche}">
				<option th:text="#{aucune}" value=""></option>
				<option th:each="rucheopt : ${ruches}" th:value="${rucheopt.id}" th:text="${rucheopt.nom}"></option>
			</select> <label class="form-label" for="ruche" th:text="#{ruche}"></label>
		</div>
		<div class="form-floating mb-3 ruches" style="display: none">
			<select class="form-control" th:field="*{essaim}">
				<option th:text="#{aucun}" value=""></option>
				<option th:each="essaimopt : ${essaims}" th:value="${essaimopt.id}" th:text="${essaimopt.nom}"></option>
			</select> <label class="form-label" for="essaim" th:text="#{essaim}"></label>
		</div>
		<div class="form-floating mb-3 ruches" style="display: none">
			<select class="form-control" th:field="*{rucher}">
				<option th:text="#{aucun}" value=""></option>
				<option th:each="rucheropt : ${ruchers}" th:value="${rucheropt.id}" th:text="${rucheropt.nom}"></option>
			</select> <label class="form-label" for="rucher" th:text="#{rucher}"></label>
		</div>
		<div class="form-floating mb-3 ruches" style="display: none">
			<select class="form-control" th:field="*{hausse}">
				<option th:text="#{aucune}" value=""></option>
				<option th:each="hausseopt : ${hausses}" th:value="${hausseopt.id}" th:text="${hausseopt.nom}"></option>
			</select> <label for="hausse" th:text="#{hausse}"></label>
		</div>
		<div th:replace="~{includeForm :: BtnForm}"></div>
	</form>
	<footer th:replace="~{include::footer}"></footer>
</body>

</html>
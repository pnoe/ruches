<!DOCTYPE HTML>
<html xmlns:th="https://www.thymeleaf.org">

<head th:replace="~{include :: common_header(~{::script},~{::style},~{::link})}">
	<script>
		// https://stackoverflow.com/questions/17237812/datatable-jquery-table-header-width-not-aligned-with-body-width
		document.addEventListener('DOMContentLoaded', () => {
			new DataTable('.datatable-tri', {
				paging: false,
				searching: false,
				info: false,
				scrollX: true
			});
			for (const coll of document.getElementsByClassName('collapse')) {
				coll.addEventListener('shown.bs.collapse', event => {
					// boucle for pour passer les tableaux non datatables
					for (const tbl of event.target.getElementsByClassName('datatable-tri')) {
						$(tbl).DataTable().columns.adjust();
					}
				}, {once: true});
			}
		});
	</script>
</head>

<body>
	<nav th:replace="~{navbar::navbar}"></nav>
	<br />
	<br />
	<br />
	<div class="container-fluid" id="info">
		<div class="row">
			<h1 class="item" th:utext="${@environment.getProperty('accueil.titre')}"></h1>
		</div>
		<div class="row">
			<ul>
				<li th:text="|${nbRuchers} #{ruchersdepot}|"></li>
				<li th:text="|${nbRuches} #{ruches} (${nbRuchesProd} #{production} + ${nbRuchesElev} #{elevage})|"></li>
				<li
					th:text="|${nbRuchesAuDepot} #{ruchesaudepot} (${nbRuchesAuDepotProd} #{production} + ${nbRuchesAuDepotElev} #{elevage})|">
				</li>
				<li
					th:text="|${nbRuchesAvecEssaim} #{ruchesavecessaim} (${nbRuchesAvecEssaimProd} #{production} + ${nbRuchesAvecEssaimElev} #{elevage})|">
				</li>
				
				
				<li
					th:text="|${nbRuchesAvecEssaim + #arrays.length(essaimsActifSansRuche)} #{essaim_s} (${#arrays.length(essaimsActifSansRuche)} #{essaimsHorsRuche})|">
				</li>
				
				
				
				<li
					th:text="|${nbHausses} #{hausses} (${nbHaussesSurRuchesAvecEssaim} #{posees} + ${nbHaussesHorsRuche} #{nonposees})|">
				</li>
			</ul>
		</div>
	</div>
	<div class="accordion" id="accordion">
		<div class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse0" aria-expanded="true" aria-controls="collapse0"
					th:text="#{distButinage}">
				</button>
			</h1>
			<div id="collapse0" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{rayonkm}"></th>
								<th scope="col" th:text="#{surfacekm2}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="rayon : ${rayonsButinage}">
								<td th:text="${#numbers.formatDecimal(rayon/1000.0,1,3)}"></td>
								<td th:text="${#numbers.formatDecimal(rayon*rayon*3.141592653589793/1000000.0,1,3)}">
								</td>
							</tr>

						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse1" aria-expanded="true" aria-controls="collapse1"
					th:text="#{valeursParAnnee}">
				</button>
			</h1>
			<div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body table-responsive">
					<table class="table table-bordered table-striped table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{date}"></th>
								<th scope="col" th:each="annee : ${annees}"
									th:text="${#numbers.formatDecimal(annee,1,0)}"></th>
								<th>Total</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="row" th:text="#{poidsMielEnPot}"></th>
								<td th:each="pds : ${pdsMiel}"
									th:text="${#numbers.formatDecimal(pds/1000.0,1,2,'DEFAULT')}">
								</td>
							</tr>
							<tr>
								<th scope="row" th:text="#{nbEssaims}"></th>
								<td th:each="nbE : ${nbEssaims}" th:text="${nbE}"></td>
								<td></td>
							</tr>
							<tr>
								<th scope="row" th:text="#{poidsMiel_nbEssaims}"></th>
								<td th:each="nbE : ${nbEssaims}"
									th:text="${#numbers.formatDecimal(pdsMiel[nbEStat.index]/nbE/1000.0,1,2,'DEFAULT')}">
								</td>
								<td></td>
							</tr>
							<tr>
								<th scope="row" th:text="#{nbEssaimsCrees}"></th>
								<td th:each="nbCree : ${nbCreationEssaims}" th:text="${nbCree}"></td>
							</tr>
							<tr>
								<th scope="row" th:text="#{nbEssaimsDisperses}"></th>
								<td th:each="nbDisp : ${nbDispersionEssaims}" th:text="${nbDisp}"></td>
							</tr>
							<tr>
								<th scope="row" th:text="#{actionSucre}"></th>
								<td th:each="sucre : ${sucreEssaims}"
									th:text="${#numbers.formatDecimal(sucre,1,2,'DEFAULT')}">
								</td>
							</tr>
							<tr>
								<th scope="row" th:text="#{nbTraitements}"></th>
								<td th:each="nbTraitements : ${nbTraitementsEssaims}" th:text="${nbTraitements}"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div th:if="${#arrays.length(ruchesDepotEssaim)} &gt; 0" class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse3" aria-expanded="true" aria-controls="collapse3"
					th:text="${#arrays.length(ruchesDepotEssaim)} + ' ' + #{ruchesAvecEssaimDepot}">
				</button>
			</h1>
			<div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped datatable-tri table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{nom}"></th>
								<th scope="col" th:text="#{essaim}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="rucheDepotEssaim : ${ruchesDepotEssaim}">
								<td><a th:href="@{'/ruche/'+${rucheDepotEssaim.id}}"
										th:text="${rucheDepotEssaim.nom}"></a>
								</td>
								<td><a th:href="@{'/essaim/'+${rucheDepotEssaim.essaim?.id}}"
										th:text="${rucheDepotEssaim.essaim?.nom}"></a></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div th:if="${#arrays.length(ruchesDepotHausses)} &gt; 0" class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse4" aria-expanded="true" aria-controls="collapse4"
					th:text="${#arrays.length(ruchesDepotHausses)} + ' ' + #{ruchesAvecHaussesDepot}">
				</button>
			</h1>
			<div id="collapse4" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped datatable-tri table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{nom}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="rucheDepotHausses : ${ruchesDepotHausses}">
								<td><a th:href="@{'/ruche/'+${rucheDepotHausses.id}}"
										th:text="${rucheDepotHausses.nom}"></a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div th:if="${#arrays.length(ruchesPasDepotSansEssaim)} &gt; 0" class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse5" aria-expanded="true" aria-controls="collapse5"
					th:text="${#arrays.length(ruchesPasDepotSansEssaim)} + ' ' + #{ruchesSansEssaimPasDepot}">
				</button>
			</h1>
			<div id="collapse5" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped datatable-tri table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{nom}"></th>
								<th scope="col" th:text="#{rucher}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="ruchePasDepotSansEssaim : ${ruchesPasDepotSansEssaim}">
								<td><a th:href="@{'/ruche/'+${ruchePasDepotSansEssaim.id}}"
										th:text="${ruchePasDepotSansEssaim.nom}"></a></td>
								<td><a th:href="@{'/rucher/'+${ruchePasDepotSansEssaim.rucher?.id}}"
										th:text="${ruchePasDepotSansEssaim.rucher?.nom}"></a></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div th:if="${#arrays.length(essaimsActifSansRuche)} &gt; 0" class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse6" aria-expanded="true" aria-controls="collapse6"
					th:text="${#arrays.length(essaimsActifSansRuche)} + ' ' + #{essaimsHorsRuche}">
				</button>
			</h1>
			<div id="collapse6" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped datatable-tri table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{nom}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="essaimActifSansRuche : ${essaimsActifSansRuche}">
								<td><a th:href="@{'/essaim/'+${essaimActifSansRuche.id}}"
										th:text="${essaimActifSansRuche.nom}"></a></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div th:if="${#arrays.length(ruchersMalCales)} &gt; 0" class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse7" aria-expanded="true" aria-controls="collapse7" th:text="${#arrays.length(ruchersMalCales)} + ' ' +
			#{ruchersLoinDeLeursRuches(${#numbers.formatDecimal(distRuchersTropLoins,1,0)})}">
				</button>
			</h1>
			<div id="collapse7" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped datatable-tri table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{nom}"></th>
								<th scope="col" th:text="#{Distance}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="rucherMalCale : ${ruchersMalCales}">
								<td><a th:href="@{'/rucher/'+${rucherMalCale.id}}" th:text="${rucherMalCale.nom}"></a>
								</td>
								<td th:text="${#numbers.formatDecimal(distances[rucherMalCaleStat.index],1,0)}"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div th:if="${#arrays.length(ruchesTropLoins)} &gt; 0" class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse8" aria-expanded="true" aria-controls="collapse8" th:text="${#arrays.length(ruchesTropLoins)} + ' ' +
			#{ruchesAPlusde(${#numbers.formatDecimal(distRuchesTropLoins,1,0)})}">
				</button>
			</h1>
			<div id="collapse8" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped datatable-tri table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{nom}"></th>
								<th scope="col" th:text="#{rucher}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="rucheTropLoin : ${ruchesTropLoins}">
								<td><a th:href="@{'/ruche/'+${rucheTropLoin.id}}" th:text="${rucheTropLoin.nom}"></a>
								</td>
								<td><a th:href="@{'/rucher/'+${rucheTropLoin.rucher?.id}}"
										th:text="${rucheTropLoin.rucher?.nom}"></a></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div th:if="${#arrays.length(ruchesPasDEvenement)} &gt; 0" class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse9" aria-expanded="true" aria-controls="collapse9" th:text="${#arrays.length(ruchesPasDEvenement)} + ' ' +
				#{ruchesSansEven(${retardRucheEvenement})}">
				</button>
			</h1>
			<div id="collapse9" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped datatable-tri table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{nom}"></th>
								<th scope="col" th:text="#{rucher}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="ruchePasDEvenement : ${ruchesPasDEvenement}">
								<td><a th:href="@{'/ruche/'+${ruchePasDEvenement.id}}"
										th:text="${ruchePasDEvenement.nom}"></a>
								</td>
								<td><a th:href="@{'/rucher/'+${ruchePasDEvenement.rucher?.id}}"
										th:text="${ruchePasDEvenement.rucher?.nom}"></a></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div th:if="${#arrays.length(essaimDateNaissSupAcquis)} &gt; 0" class="accordion-item">
			<h1 class="accordion-header">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#collapse10" aria-expanded="true" aria-controls="collapse10" th:text="${#arrays.length(essaimDateNaissSupAcquis)} + ' ' +
			#{essaimDateNaissSupAcquis}">
				</button>
			</h1>
			<div id="collapse10" class="accordion-collapse collapse" data-bs-parent="#accordion">
				<div class="accordion-body">
					<table class="table table-bordered table-striped datatable-tri table-sm">
						<thead>
							<tr>
								<th scope="col" th:text="#{nom}"></th>
								<th scope="col" th:text="#{reineDateNaissance}"></th>
								<th scope="col" th:text="#{dateAcquisition}"></th>
								<th scope="col" th:text="#{diff}"></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="essaim : ${essaimDateNaissSupAcquis}"
								th:with="N=${essaim.reineDateNaissance},A=${essaim.dateAcquisition},D=${T(java.time.Duration)}">
								<td><a th:href="@{'/essaim/'+${essaim.id}}" th:text="${essaim.nom}"></a></td>
								<td th:text="${N}"></td>
								<td th:text="${A}"></td>
								<td th:text="${D.between(A.atStartOfDay(),N.atStartOfDay()).toDays()}"></td>

							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<br />
	<footer th:replace="~{include::footer}"></footer>
</body>

</html>